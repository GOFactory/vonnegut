%% -*- erlang -*-
{erl_opts,
 [debug_info,
  warn_untypes_records,
  warnings_as_errors,
  {parse_transform, lager_transform}]}.

{cover_enabled, true}.
{cover_export_enabled, true}.

{coveralls_coverdata    , "_build/test/cover/ct.coverdata"}.
{coveralls_service_name , "circle-ci"}.

{xref_checks,[undefined_function_calls,undefined_functions,locals_not_used,
              deprecated_function_calls,
              deprecated_functions]}.

{deps, [gproc,
        erlware_commons,
        acceptor_pool,
        %% shackle,
        {shackle, ".*",
         {git, "https://github.com/lpgauth/shackle.git", {tag, "0.3.4"}}},
        {partisan, {git, "https://github.com/lasp-lang/partisan.git", {branch, "down-functions"}}},
        lager]}.

{relx, [{release, {vonnegut, "0.0.1"},
         [vonnegut]},

        {dev_mode, true},
        {include_erts, false},

        {sys_config, "config/sys.config"},
        {vm_args, "config/vm.args"},

        {extended_start_script, true}]}.

{plugins, [rebar3_proper,
           {coveralls, {git, "https://github.com/evanmcc/coveralls-erl", "allow-circle"}}]}.

{profiles,
 [{test, [
         {deps, [meck, {proper, "1.1.1-beta"}]}
         ]},
 {prod, [{relx, [{sys_config, "config/prod_sys.config"},
                 {vm_args, "config/prod_vm.args"},
                 {dev_mode, false},
                 {include_erts, true}]}]}
 ]}.

{ct_opts, [{sys_config, "config/sys.config"}, {ct_hooks, [cth_surefire]}]}.
